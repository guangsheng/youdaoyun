缺少了测试，我们就无法保证功能能够正常运行；缺少了构建，就没有什么东西可部署；缺少了部署，用户就无法从新的发布中受益。

#### 基于容器的持续部署
容器技术的出现可以轻松的处理各种测试问题，因为测试和最后需要部署到生产环境的是同一个容器，里面包含的系统运行所需要的运行时与依赖都是相同的。
1. PRE-DEPLOYMENT
```
graph TD
    1A[Build the tests container] --> 1B[Push the tests container]
    1B --> 1C[Run pre-deployment tests]
    1C --> 1D[OK]
    1C --> 1E[Failure]
    1D --> 1F[Build the container]
    1F --> 1G[Push the container]
```
2. DEPLOYMENT
```
graph TD
    2A[Pull the container] --> 2B[Run the container:blue-green]
    2B --> 2C[Register the new service]
```
3. POST-DEPLOYMENT
```
graph TD
    3A[Run pre-Integration tests] --> 3B[OK]
    3A --> 3C[Failure]
    3B --> 3D[Configure proxy]
    3D --> 3E[Register the color]
    3E --> 3F[Run post-Integration test]
    3F --> 3G[OK]
    3F --> 3H[Failure]
```
4. ROLLBACK & CLEANUP
```
graph TD
    4A[Rollback proxy] --> 4B[Register the old color]
    4B --> 4C[Stop the new release]
    4C --> 4D[De-register the new service]
    4D --> 4E[Stop the old release]
    4E --> 4F[De-register the old service]
```
##### 组合
```
graph TB
    subgraph ROLLBACK & CLEANUP
    4A[Rollback proxy] --> 4B[Register the old color]
    4B --> 4C[Stop the new release]
    4C --> 4D[De-register the new service]
    4D --> 4E[Stop the old release]
    4E --> 4F[De-register the old service]
    end
    
    subgraph POST-DEPLOYMENT
    3A[Run pre-Integration tests] --> 3B[OK]
    3A --> 3C[Failure]
    3B --> 3D[Configure proxy]
    3D --> 3E[Register the color]
    3E --> 3F[Run post-Integration test]
    3F --> 3G[OK]
    3F --> 3H[Failure]
    end
    
    subgraph DEPLOYMENT
    2A[Pull the container] --> 2B[Run the container:blue-green]
    2B --> 2C[Register the new service]
    end
    
    subgraph PRE-DEPLOYMENT
    1A[Build the tests container] --> 1B[Push the tests container]
    1B --> 1C[Run pre-deployment tests]
    1C --> 1D[OK]
    1C --> 1E[Failure]
    1D --> 1F[Build the container]
    1F --> 1G[Push the container]
    end
    1G --> 2A
    2C --> 3A
    3C --> 4C
    3G --> 4E
    3H --> 4A
```



