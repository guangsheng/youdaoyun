#### docker build
从dockerfile创建镜像文件

#### Dockerfile
##### 指令的EXEC与SHELL格式
exec格式适用于需要规避shell对字符串做出错误解析的情况，或者镜像里没有包含/bin/sh时

##### 可用指令
- FROM
    - 指定Dockerfile使用的基础镜像
- ADD
- CMD
    - 当容器启动时执行的指令，如果同时定义了ENTRYPOINT,该执行会被解释为ENTRYPOINT的参数
- COPY
    - 用于从构建环境的上下文复制文件至镜像
- ENTRYPOINT
    - 设置一个容器启动时运行的可执行文件（以及默认参数）
- ENV
    - 设置的这些变量在镜像中仍然可用
- EXPOSE
    - 表示容器会有一个进程监听所指定的端口
- MAINTAINER
    - 把镜像中的作者元数据设定为指定的字符串
- ONBUILD
    - 指定当镜像被用作另一个镜像的基础镜像时将会执行的指令
- RUN
- USER
    - 设置任何后续的RUN,CMD,ENTRYPOINT指令执行时所用的用户（用户名或UID）
- VOLUME
    - 指定作为数据卷的文件或目录
    - **VOLUME指令之后的所有对数据卷修改的指令都不会生效（如果想要修改，那就放到VOLUME指令之前吧）**
- WORKDIR
    - 为后续的RUN,CMD,ENTRYPOINT,ADD,COPY指令设置工作目录，支持多次使用

##### 建议
- 启动容器时要指定运行用户（在Dockerfile中指定或者docker run命令中指定）
    - 容器内创建的用户和用户组并不会传播到主机，这样就有可能导致相同的文件，在容器内和容器外显示的拥有者可能不一样
    - 如果用root用户运行，则入侵者侵入容器后，就能获得主机的root权限。


#### 参考
##### docker build
```
root@bogon:/opt/docker/identidock# tree
.
|____Dockerfile
|____app
| |____identidock.py
|____cmd.sh
root@bogon:/opt/docker/identidock# cat Dockerfile 
FROM python:3.4

RUN pip install Flask==0.10.1
WORKDIR /app
COPY app /app
COPY cmd.sh /
RUN chmod 750 /cmd.sh
CMD ["/cmd.sh"]
root@bogon:/opt/docker/identidock# docker build -t identidock:1.0.0 .
Sending build context to Docker daemon  4.608kB
Step 1/7 : FROM python:3.4
 ---> 1306ea7c055d
Step 2/7 : RUN pip install Flask==0.10.1
 ---> Running in b6bf155c8c7f
Collecting Flask==0.10.1
  Downloading Flask-0.10.1.tar.gz (544kB)
Collecting Werkzeug>=0.7 (from Flask==0.10.1)
  Downloading Werkzeug-0.12.2-py2.py3-none-any.whl (312kB)
Collecting Jinja2>=2.4 (from Flask==0.10.1)
  Downloading Jinja2-2.9.6-py2.py3-none-any.whl (340kB)
Collecting itsdangerous>=0.21 (from Flask==0.10.1)
  Downloading itsdangerous-0.24.tar.gz (46kB)
Collecting MarkupSafe>=0.23 (from Jinja2>=2.4->Flask==0.10.1)
  Downloading MarkupSafe-1.0.tar.gz
Building wheels for collected packages: Flask, itsdangerous, MarkupSafe
  Running setup.py bdist_wheel for Flask: started
  Running setup.py bdist_wheel for Flask: finished with status 'done'
  Stored in directory: /root/.cache/pip/wheels/b6/09/65/5fcf16f74f334a215447c26769e291c41883862fe0dc7c1430
  Running setup.py bdist_wheel for itsdangerous: started
  Running setup.py bdist_wheel for itsdangerous: finished with status 'done'
  Stored in directory: /root/.cache/pip/wheels/fc/a8/66/24d655233c757e178d45dea2de22a04c6d92766abfb741129a
  Running setup.py bdist_wheel for MarkupSafe: started
  Running setup.py bdist_wheel for MarkupSafe: finished with status 'done'
  Stored in directory: /root/.cache/pip/wheels/88/a7/30/e39a54a87bcbe25308fa3ca64e8ddc75d9b3e5afa21ee32d57
Successfully built Flask itsdangerous MarkupSafe
Installing collected packages: Werkzeug, MarkupSafe, Jinja2, itsdangerous, Flask
Successfully installed Flask-0.10.1 Jinja2-2.9.6 MarkupSafe-1.0 Werkzeug-0.12.2 itsdangerous-0.24
 ---> 37a7e566b4cf
Removing intermediate container b6bf155c8c7f
Step 3/7 : WORKDIR /app
 ---> e634627c84ed
Removing intermediate container 4415fb640d2e
Step 4/7 : COPY app /app
 ---> 52743e70806e
Removing intermediate container a20aa37b5ea0
Step 5/7 : COPY cmd.sh /
 ---> 88021238c124
Removing intermediate container e6d452061e6e
Step 6/7 : RUN chmod 750 /cmd.sh
 ---> Running in ea8f76d3b831
 ---> 9712868af108
Removing intermediate container ea8f76d3b831
Step 7/7 : CMD /cmd.sh
 ---> Running in 0dc47fbaf945
 ---> 7fb6ffe50f9e
Removing intermediate container 0dc47fbaf945
Successfully built 7fb6ffe50f9e
Successfully tagged identidock:1.0.0
root@bogon:/opt/docker/identidock# docker run -d -p 5000:5000 identidock:1.0.0
5b11d21e4c8fdd655c98d43760f556457bdbfc5f071a4c5b4cea4d1b8fb4e17b

```