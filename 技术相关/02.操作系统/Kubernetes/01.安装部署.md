### 参考：[follow-me-install-kubernetes-cluster](https://github.com/opsnull/follow-me-install-kubernetes-cluster)


### 下载软件
```
wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64
wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64
wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64
wget https://github.com/coreos/etcd/releases/download/v3.1.6/etcd-v3.1.6-linux-amd64.tar.gz
wget https://github.com/coreos/flannel/releases/download/v0.7.1/flannel-v0.7.1-linux-amd64.tar.gz
wget https://dl.k8s.io/v1.6.2/kubernetes-server-linux-amd64.tar.gz
wget https://get.docker.com/builds/Linux/x86_64/docker-17.04.0-ce.tgz
wget https://github.com/kubernetes/heapster/archive/v1.3.0.zip
wget  --continue https://github.com/vmware/harbor/releases/download/v1.1.0/harbor-offline-installer-v1.1.0.tgz
```

### 检查并重启应用
```
# master
systemctl status etcd
systemctl status docker
systemctl status flanneld
systemctl status kube-apiserver
systemctl status kube-controller-manager
systemctl status kubelet
systemctl status kube-proxy
systemctl status kube-scheduler
# node
systemctl status etcd
systemctl status docker
systemctl status flanneld
systemctl status kubelet
systemctl status kube-proxy
```

### DNS问题解决
#### 使用的插件是k8s自带的一个插件，目录：kubernetes/cluster/addons/dns

#### 检查安装是否正常的方法
**如果重新配置了DSN，要删掉这个POD重建**
```
cat > busybox.yaml << EOF
apiVersion: v1
kind: Pod
metadata:
  name: busybox
  namespace: default
spec:
  containers:
  - image: busybox
    command:
    - sleep
    - "3600"
    imagePullPolicy: IfNotPresent
    name: busybox
  restartPolicy: Always
EOF

kubectl create -f busybox.yaml

kubectl get pods |grep busy

kubectl exec busybox -- nslookup kubernetes
```


#### DNS相关环境变量和配置
```
# 环境变量
export CLUSTER_DNS_SVC_IP="10.254.0.2"
export CLUSTER_DNS_DOMAIN="cluster.local."

# kubelet启动参数
--cluster-dns=10.254.0.2
--cluster-domain=cluster.local.
```

#### 安装注意事项
+ 要使用k8s自带的yaml进行修改，不要使用 参考的附件中的
+ 可能会出现下载镜像失败的问题，可以在hosts文件中增加```61.91.161.217  gcr.io```尝试看下，如果还是不行，就需要翻墙下载
 

#### 应用样例
kubernetes中自带的留言板应用  
kubernetes/examples/guestbook-go  
kubernetes/examples/guestbook

```
iptables --list
iptables -P FORWARD ACCEPT
```