### 参考
https://yq.aliyun.com/articles/62314?spm=5176.8091938.0.0.y665kg  
https://github.com/postgrespro/pg_pathman

### 支持的功能
- 支持range, hash分区，可以指定自动创建分区
- 支持的分区字段类型：int, float, date以及其他常用类型
- 支持将主表数据迁移到分区表
- 支持将已有的表绑定到主表，也支持分区表剥离
- 非堵塞式创建分区表，以及后台自动将主表数据迁移到分区表，非堵塞式
- 支持FDW，通过配置参数pg_pathman.insert_into_fdw=(disabled | postgres | any_fdw)支持postgres_fdw或任意fdw
- 通过用户自建更新触发器的方式，支持更新分区表字段
- 可以指定在创建分区时的执行的触发器
- 创建分区表时会自动创建主表类似的索引，但是如果分区表已经存在，此时在主表上创建索引，分区表不会自动创建。

### 约束和限制
- 分区列必须有not null属性
- 如果主表已经有数据，分区个数必须能覆盖所有数据

### 相关视图表和函数
#### 视图和表
- pathman_config --- 所有分区表的必填属性记录
- pathman_config_params --所有分区表的可选属性记录
- pathman_partition_list --分区表子表的详细信息
- pathman_cache_stats
- pathman_concurrent_part_tasks  --主表向字表迁移数据的详细信息

#### 函数	
##### 分区管理
- ```create_range_partitions```  :  创建range分区表，需要指定主表OID、分区列名、起始值、分区间隔、分区表个数、是否同时迁移主表数据等参数
- ```create_hash_partitions```  : 创建hash分区表，需要指定主表OID、分区列名、分区个数、是否同时迁移主表数据等参数
- ```split_range_partition```  : 分裂指定的范围分区表，需要指定分区表OID、分裂值（比如是范围的中值）、新分区表名称
- ```merge_range_partitions```  :  合并分区表，必须是相邻分区，指定要合并的分区表1 OID和分区表2 OID
- ```append_range_partition```  : 向后添加分区，间隔使用最初创建分区表时指定的值。指定主表OID。
- ```prepend_range_partition```  : 向前添加分区，间隔使用最初创建分区表时指定的值。指定主表OID。
- ```add_range_partition```  : 添加分区，需要指定主表OID、起始值、结束值。 只是添加了一个分区表，这个分区表的范围是指定的起始和结束值。
- ```drop_range_partition```  : 删除指定分区，需要指定分区表名称和是否保留分区表数据
- ```drop_partitions```  : 删除所有分区，并且指定是否要将数据迁移到主表
- ```attach_range_partition```  : 将一个普通表绑定成为一个分区表
- ```detach_range_partition```  : 解绑定一个分区表
- ```set_auto```  :  自动扩展分区，当插入数据不再已分区范围内时，会自动创建分区。需要指定主表oid和是否自动扩展分区标志。

##### 数据迁移
- ```partition_table_concurrently```  :  迁移主表数据，需要指定主表OID, 一个事务迁移多少记录，获取行锁失败间隔多久再次获取（重试60次退出任务）
- ```stop_concurrent_part_task```  : 停止数据迁移任务。需要指定主表OID

##### 性能优化相关
- ```set_enable_parent```  : 设置主表是否禁用，禁用后主表不会出现在执行计划中。指定主表OID和是否禁用

##### pathman自身表和视图相关
- ```pathman_config_params_trigger_func```  : ```pathman_config_params```表的触发器函数
- ```show_concurrent_part_tasks```  :  表```pathman_concurrent_part_tasks```
- ```show_partition_list```  : 表```pathman_partition_list```

##### 其他非常用函数
- ```alter_partition```  :  修改分区表所属用户，所属表空间
- ```add_to_pathman_config```  : 
- ```build_check_constraint_name```  : 
- ```build_hash_condition```  : 
- ```build_range_condition```  : 
- ```build_sequence_name```  : 
- ```build_update_trigger_func_name```  : 
- ```build_update_trigger_name```  : 
- ```check_boundaries```  : 
- ```check_range_available```  : 
- ```check_security_policy```  : 
- ```copy_foreign_keys```  : 
- ```create_naming_sequence```  : 
- ```create_single_range_partition```  : 
- ```create_single_update_trigger```  : 
- ```create_update_triggers```  : 
- ```debug_capture```  : 
- ```drop_naming_sequence```  : 
- ```drop_range_partition_expand_next```  : 
- ```drop_triggers```  : 
- ```get_base_type```  : 
- ```get_hash_part_idx```  : 
- ```get_number_of_partitions```  : 
- ```get_parent_of_partition```  : 
- ```get_partition_key```  : 
- ```get_partition_key_type```  : 
- ```get_partition_type```  : 
- ```get_part_range```  : 
- ```get_pathman_lib_version```  : 
- ```get_plain_schema_and_relname```  : 
- ```get_tablespace```  : 
- ```generate_range_bounds```
- ```has_update_trigger```  : 
- ```invoke_on_partition_created_callback```  : 
- ```is_date_type```  : 
- ```is_operator_supported```  : 
- ```is_tuple_convertible```  : 
- ```partition_data```  : 
- ```_partition_data_concurrent```  : 
- ```pathman_ddl_trigger_func```  : 
- ```pathman_set_param```  : 
- ```pathman_update_trigger_func```  : 
- ```prepare_for_partitioning```  : 
- ```prevent_data_modification```  : 
- ```prevent_part_modification```  : 
- ```replace_hash_partition```  : 
- ```set_init_callback```  : 
- ```set_interval```  : 
- ```set_spawn_using_bgw```  : 
- ```show_cache_stats```  : 
- ```validate_expression```  : 
- ```validate_interval_value```  : 
- ```validate_part_callback```  : 
- ```validate_relname```  : 
- ```disable_pathman_for```  : 针对单个分区主表禁用pg_pathman，不可逆。
##### 内部使用
- ```create_range_partitions_internal``` 
- ```create_hash_partitions_internal```
- ```append_partition_internal```
- ```prepend_partition_internal```

### 以日期分区的使用场景