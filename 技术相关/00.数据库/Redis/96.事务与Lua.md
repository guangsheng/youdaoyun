### 事务
#### 重要作用： 事务中的命令是按原子顺序执行的，事务中命令执行过程中其他客户端还是可以下发命令穿插执行的
#### 命令
- multi  代表命令开始
- exec   代表命令结束
- discard  代表事务废弃（rollback）

#### 命令结果对应的状态
- 命令错误： 整个事务都不生效
- 运行时错误： 前面执行的已经生效了，无法回滚

#### watch命令
在multi之前执行watch命令，可以保证事务中的watch对象没有被修改过才执行事务中命令，否则不执行。

### Lua： C语言实现的脚本语言

### Redis于Lua
#### Lua脚本在Redis中是原子执行的，执行过程不会插入其他命令
#### 执行方式一
```evel 脚本名称 key个数 key列表 参数列表```

#### 执行方式二
```evelsha sha1 脚本SHA1值 key个数 key列表 参数列表```  

- 将lua脚本加载到redis服务端，得到这个脚本的SHA1校验和（```redis-cli script load xx.lua```）
- 使用SHA1校验和执行对应的LUA脚本
- 脚本管理命令
	- ```script load script```
	- ```script exists sha1 [sha1 ...]```
	- ```script flush```    用于清除Redis内存中已经加载的所有Lua脚本
	- ```script kill```     杀掉正在执行的Lua脚本

#### Redis提供了一个```lua-time-limit```的参数，默认是5秒，超过这个值后，其他客户端在执行正常的命令时，将会收到“Busy Redis is busy running a script"的错误。

#### Lua的Redis API
- redis.call   执行失败，脚本执行结束会返回错误
- redis.pcall  执行失败开会忽略错误继续执行脚本
